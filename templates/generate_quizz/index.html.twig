{% extends 'layout.html.twig' %}

{% block layout_title %}ChefQuizAI{% endblock %}


{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" type="text/css" href="{{ asset('css/style.css') }}">
{% endblock %}


{% block content %}
    <div class="row">
        <!-- Left side panel for quiz generation -->
        <div class="col-12 col-lg-2" style="padding-right: 50px;">
            <form id="generate-quiz-form" class="mb-4">

                <div class="mb-3">
                    <label for="quiz-title" class="form-label" style="font-weight: bold;">Quiz Title</label>
                    <input type="text" class="form-control" id="quiz-title" placeholder="Enter Title">
                </div>

                <div class="mb-3">

                    <label for="quiz-type" class="form-label" style="font-weight: bold;">Quiz Type</label>
                    <select class="form-select" id="quiz-type">
                        <option value="" disabled selected>Select Type</option>
                        <option value="Food safety">Food Safety</option>
                        <option value="Cross contamination">Cross Contamination</option>
                        <option value="Cooking Methods">Cooking Methods</option>
                        <option value="Receiving and Storing Goods">Receiving and Storing Goods</option>
                        <option value="Allergens">Allergens</option>
                        <option value="Hygiene">Hygiene</option>
                    </select>
                </div>

                <button type="button" class="btn btn-primary" id="generate-quiz-button" style="margin-top: 350px;">Generate Quiz</button>
            </form>


            <button class="btn btn-success" id="approve-quiz-button">Approve Quiz</button>
        </div>

        <!-- Right side panel for displaying the generated quiz as a manually controlled slider -->
        <div class="col-12 col-lg-10">
            <div id="quizCarousel" class="carousel slide" data-bs-ride="false">
                <div class="carousel-inner">


                    <!-- Case Scenario Slide -->
                    <div class="carousel-item active">
                        <div class="card mb-4" style="background-color: #0056b3; padding: 20px;">
                            <div class="card-body">
                                <h5 class="card-title" style="color: white;">Case Scenario</h5>
                                <div style="position: relative; border: 1px solid #ddd; padding: 10px; margin-bottom: 15px; border-radius: 5px; background-color: #fff; min-height: 635px; display: flex; align-items: center; justify-content: center; text-align: center;">
                                    <!-- Loading Indicator-->
                                    <div id="loading-indicator" class="text-center" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <span>Loading, please wait...</span>
                                    </div>
                                    <!-- Placeholder or dynamic GPT API content -->
                                    <div id="case-scenario-content" style="line-height: 1.6; width: 100%;">
                                        {% if scenarioText is defined %}
                                            <p class="card-text case-scenario">{{ scenarioText }}</p>
                                        {% else %}
                                            <p class="card-text case-scenario">[Case Scenario will be displayed here]</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Question Slides -->
                    {% for i in 1..5 %}
                        <div class="carousel-item">
                            <div class="card mb-4" style="background-color: #0056b3; padding: 20px;">
                                <div class="card-body">
                                    <h5 class="card-title" style="color: white;">Question {{ i }}</h5>
                                    <div style="border: 1px solid #ddd; padding: 10px; margin-bottom: 15px; border-radius: 5px; background-color: #fff;">
                                        <p class="card-text question-text">[Question Text]</p>
                                    </div>

                                    <!-- Answer Options for Question {{ i }} -->
                                    <div class="options">
                                        {% for j in 1..4 %}
                                            <div style="border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px; background-color: #f9f9f9;">
                                                <h6>Option {{ j }}
                                                    {% if j == 2 %} <!-- Simulate the correct answer for demonstration -->
                                                        <span style="color: red;">Correct Answer</span>
                                                    {% endif %}
                                                </h6>
                                                <div style="border: 1px solid #ccc; padding: 5px; border-radius: 5px; background-color: #fff;">
                                                    <p style="font-size: small;">[Option Text]</p>
                                                </div>
                                                <div style="border: 1px solid #ccc; padding: 5px; border-radius: 5px; background-color: #fff; margin-top: 5px;">
                                                    <small>[Feedback]</small>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <!-- Bootstrap carousel controls -->
                <a class="carousel-control-prev" role="button" data-bs-target="#quizCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </a>
                <a class="carousel-control-next" role="button" data-bs-target="#quizCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </a>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $(document).ready(function() {
            $('#generate-quiz-button').click(function() {
                // Hide case scenario content
                $('#case-scenario-content').hide();

                // Show loading indicator
                $('#loading-indicator').show();

                $.ajax({
                    type: 'POST',
                    url: '{{ path('app_generate_quizz') }}',
                    success: function(data) {
                        // Hide the loading indicator
                        $('#loading-indicator').hide();

                        // Show case scenario content again
                        $('#case-scenario-content').show();

                        // Update the scenario text
                        $('.case-scenario').text(data.scenarioText);
                    },
                    error: function() {
                        // Hide the loading indicator
                        $('#loading-indicator').hide();

                        // Show case scenario content even if there's an error, could adjust based on requirements
                        $('#case-scenario-content').show();

                        // Show an error message
                        $('.case-scenario').text('Error occurred. Please try again.');
                    }
                });
            });
        });
    </script>
{% endblock %}




